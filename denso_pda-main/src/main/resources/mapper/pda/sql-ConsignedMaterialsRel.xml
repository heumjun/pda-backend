<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.denso.pdabackend.domain.pda.mapper.ConsignedMaterialsRelMapper">

    <select id="getCmrInfo" parameterType="map" resultType="com.denso.pdabackend.response.ResultMap">
    	/*getCmrInfo :: 사급 출고 마스터 데이터*/
        SELECT 
			MF15.MF15_COMPANY	/*회사*/
			,MF15.MF15_FACTORY	/*공장*/
			,MF15.MF15_NO		/*사급지시서번호*/
			,MF15.MF15_DAT		/*사급지시일자*/
			,MF15.MF15_SEQ		/*순번*/
			,MF15.MF15_CUS		/*제조사코드*/
			,CM01.CM01_NAME 	/*제조사명*/
			,MF15.MF15_INDTE	/*등록일자*/
			,MF15.MF15_EMPNO	/*등록자사번*/
			,MF13.MF13_NO 		/*출고요청번호*/
			,TO_CHAR(MF13.MF13_DAT,'YYYY-MM-DD') AS MF13_DAT		/*출고요청일자*/
			,MF13.MF13_REV 		/*출고요청 REVISION번호*/
			,MF13.MF13_SEQ 		/*출고요청순번*/
			,MF13.MF13_LINE_CODE /*라인코드*/
			,CAST(MF13.MF13_INDTE AS DATE) as MF13_INDTE	/*등록일자*/
			,MF13.MF13_EMPNO 	/*등록자사번*/
			,MF13.MF13_DAT_TIME /*출고요청시간*/
		FROM TB_MF_15 MF15
		LEFT JOIN TB_MF_13 MF13
		ON MF15.MF15_COMPANY = MF13.MF13_COMPANY 
		AND MF15.MF15_FACTORY = MF13.MF13_FACTORY 
		AND MF15.MF15_NO = MF13.MF13_NO
		LEFT JOIN TB_CM_01 CM01
		ON MF15.MF15_COMPANY = CM01.CM01_COMPANY 
		AND MF15.MF15_FACTORY = CM01.CM01_FACTORY 
		AND MF15.MF15_CUS = CM01.CM01_CODE
		WHERE MF15.MF15_NO = #{mf15No}
		ORDER BY MF15.MF15_INDTE DESC
    </select>
    
    <select id="getCmrList" parameterType="map" resultType="com.denso.pdabackend.response.ResultMap">
    	/*getCmrList :: 사급 출고 요청 아이템*/
    	SELECT 
			MF15.MF15_COMPANY	/*회사*/
			,MF15.MF15_FACTORY	/*공장*/
			,MF15.MF15_NO		/*사급지시서번호*/
			,MF15.MF15_DAT		/*사급지시일자*/
			,MF15.MF15_SEQ		/*순번*/
			,MF15.MF15_CUS		/*제조사코드*/
			,CM01.CM01_NAME 	/*제조사명*/
			,MF15.MF15_INDTE	/*등록일자*/
			,MF15.MF15_EMPNO	/*등록자사번*/
			,MF16.MF16_NO		/*사급지시 상세 번호*/
			,MF16.MF16_CODE		/*품목코드*/
			,CM08.CM08_NAME 	/*품목명*/
			,MF16.MF16_QTY		/*사급출고요청수량*/
			,MF14.MF14_QTY		/*출고요청수량*/
			,MF16.MF16_GBN		/*품목구분*/
			,ST01.ST01_GBN		/*구분*/
			,ST01.ST01_LOT		/*LOT번호*/
			,ST01.ST01_STOK		/*보관장소*/
			,CM15.CM15_NAME		/*보관장소명*/
			,ST01.ST01_DISTRICT	/*구역*/
			,CM16.CM16_NAME 	/*구역명*/
			,ST01.ST01_UNT		/*재고단위*/
			,ST01.ST01_QTY		/*재고수량*/
			,MF13.MF13_NO		/*출고요청번호*/
		FROM TB_MF_13 MF13
		INNER JOIN TB_MF_14 MF14
		ON MF13.MF13_COMPANY = MF14.MF14_COMPANY
		AND MF13.MF13_FACTORY = MF14.MF14_FACTORY
		AND MF13.MF13_NO = MF14.MF14_HNO
		INNER JOIN TB_MF_15 MF15
		ON MF13.MF13_COMPANY = MF15.MF15_COMPANY
		AND MF13.MF13_FACTORY = MF15.MF15_FACTORY
		AND MF13.MF13_NO = MF15.MF15_NO
		INNER JOIN TB_MF_16 MF16
		ON MF15.MF15_COMPANY = MF16.MF16_COMPANY 
		AND MF15.MF15_FACTORY = MF16.MF16_FACTORY 
		AND MF15.MF15_NO = MF16.MF16_HNO
		LEFT JOIN TB_CM_01 CM01
		ON MF15.MF15_COMPANY = CM01.CM01_COMPANY 
		AND MF15.MF15_FACTORY = CM01.CM01_FACTORY 
		AND MF15.MF15_CUS = CM01.CM01_CODE
		LEFT JOIN TB_ST_01 ST01
		ON MF16.MF16_COMPANY = ST01.ST01_COMPANY 
		AND MF16.MF16_FACTORY = ST01.ST01_FACTORY
		AND MF16.MF16_CODE = ST01.ST01_CODE
		LEFT JOIN TB_CM_15 CM15
		ON ST01.ST01_COMPANY = CM15.CM15_COMPANY 
		AND ST01.ST01_FACTORY = CM15.CM15_FACTORY
		AND ST01.ST01_STOK = CM15.CM15_CODE
		LEFT JOIN TB_CM_16 CM16
		ON CM15.CM15_COMPANY = CM16.CM16_COMPANY 
		AND CM15.CM15_FACTORY = CM16.CM16_FACTORY
		AND CM15.CM15_CODE = CM16.CM16_STOK
		AND ST01.ST01_DISTRICT = CM16.CM16_CODE
		LEFT JOIN TB_CM_08 CM08
		ON  MF16.MF16_COMPANY = CM08.CM08_COMPANY 
		AND MF16.MF16_FACTORY = CM08.CM08_FACTORY
		AND MF16.MF16_CODE = CM08.CM08_CODE 
		WHERE MF15.MF15_NO = #{mf15No}
		ORDER BY MF15.MF15_INDTE DESC
    </select>
    
    <select id="getQrCodeInfo" parameterType="map" resultType="com.denso.pdabackend.response.ResultMap">
    	/*getQrCodeInfo :: QRCODE가 사급 요청서 상세에 있는지 확인*/
    	SELECT 
			MF15.MF15_COMPANY	/*회사*/
			,MF15.MF15_FACTORY	/*공장*/
			,MF15.MF15_NO		/*사급지시서번호*/
			,MF15.MF15_DAT		/*사급지시일자*/
			,MF15.MF15_SEQ		/*순번*/
			,MF15.MF15_CUS		/*제조사코드*/
			,CM01.CM01_NAME 	/*제조사명*/
			,MF15.MF15_INDTE	/*등록일자*/
			,MF15.MF15_EMPNO	/*등록자사번*/
			,MF16.MF16_NO		/*사급지시 상세 번호*/
			,MF16.MF16_CODE		/*품목코드*/
			,CM08.CM08_NAME 	/*품목명*/
			,MF16.MF16_QTY		/*사급출고요청수량*/
			,MF16.MF16_GBN		/*품목구분*/
			,ST01.ST01_GBN		/*구분*/
			,ST01.ST01_LOT		/*LOT번호*/
			,ST01.ST01_STOK		/*보관장소*/
			,CM15.CM15_NAME		/*보관장소명*/
			,ST01.ST01_DISTRICT	/*구역*/
			,CM16.CM16_NAME 	/*구역명*/
			,ST01.ST01_UNT		/*재고단위*/
			,ST01.ST01_QTY		/*재고수량*/
		FROM TB_MF_15 MF15
		INNER JOIN TB_MF_16 MF16
		ON MF15.MF15_COMPANY = MF16.MF16_COMPANY 
		AND MF15.MF15_FACTORY = MF16.MF16_FACTORY 
		AND MF15.MF15_NO = MF16.MF16_HNO
		LEFT JOIN TB_CM_01 CM01
		ON MF15.MF15_COMPANY = CM01.CM01_COMPANY 
		AND MF15.MF15_FACTORY = CM01.CM01_FACTORY 
		AND MF15.MF15_CUS = CM01.CM01_CODE
		LEFT JOIN TB_ST_01 ST01
		ON MF16.MF16_COMPANY = ST01.ST01_COMPANY 
		AND MF16.MF16_FACTORY = ST01.ST01_FACTORY
		AND MF16.MF16_CODE = ST01.ST01_CODE
		AND ST01.ST01_DISTRICT IS NOT NULL
		LEFT JOIN TB_CM_15 CM15
		ON ST01.ST01_COMPANY = CM15.CM15_COMPANY 
		AND ST01.ST01_FACTORY = CM15.CM15_FACTORY
		AND ST01.ST01_STOK = CM15.CM15_CODE
		LEFT JOIN TB_CM_16 CM16
		ON CM15.CM15_COMPANY = CM16.CM16_COMPANY 
		AND CM15.CM15_FACTORY = CM16.CM16_FACTORY
		AND CM15.CM15_CODE = CM16.CM16_STOK
		AND ST01.ST01_DISTRICT = CM16.CM16_CODE
		LEFT JOIN TB_CM_08 CM08
		ON  MF16.MF16_COMPANY = CM08.CM08_COMPANY 
		AND MF16.MF16_FACTORY = CM08.CM08_FACTORY
		AND MF16.MF16_CODE = CM08.CM08_CODE
		WHERE MF15.MF15_NO = #{mf15No}
		AND MF16.MF16_NO = #{mf16No}
		ORDER BY MF15.MF15_INDTE DESC
    </select>
    
</mapper> 